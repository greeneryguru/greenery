{% extends "base.html" %}
{% block headers %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/toggle.css') }}" type= "text/css" >
    <script>
    $(document).ready(function() {
        setInterval(function(){
            $(".button").each(function(){
                var [mode, pk] = this.id.split('-',2);
                var self = this;
                if (mode == "outlet") {
                    $.get("/outlet/" + pk,
                    {'csrfmiddlewaretoken': '{{ csrf_token() }}'},
                    function(data){
                        if (data.state) {
                            if (! $(self).hasClass('button-primary')) {
                                $(self).classList.addClass('button-primary');
                            }
                        } else {
                            if ($(self).hasClass('button-primary')) {
                                $(self).removeClass('button-primary');
                            }
                        }
			        }, 'json');
                }
            });
        }, 10000);

        $(".button").on("click", function(){
            var pk = this.id.split("-")[1];
            var self = this;
            $.post("/outlet/" + pk + "/toggle",
            {'csrfmiddlewaretoken': '{{ csrf_token() }}'},
            function(data){
                if (data.state) {
                    if (! $(self).hasClass('button-primary')) {
                        $(self).classList.addClass('button-primary');
                    }
                } else {
                    if ($(self).hasClass('button-primary')) {
                        $(self).removeClass('button-primary');
                    }
                }
			}, 'json');
			return false;
        });
    });
    </script>
{% endblock %}
{% block content %}
{% if payload %}
    {% for o in payload %}
    <div class="row">    
      <div class="six columns">
        <a class="button" id="edit-{{ o.id }}" style="min-width: 180px; width: 100%;">{{ o.name }} <i class="fa fa-power-off"></i></a>
      </div>
    </div>
    {% endfor %}
{% else %}
    No data available
{% endif %}
<p>
    <a href="/outlet/edit"><i class="fa fa-edit"></i> edit</a> |
    <a href="/outlet/create"><i class="fa fa-plus"></i> add</a>
</p>
{% endblock %}
