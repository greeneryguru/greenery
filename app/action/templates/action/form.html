{% extends "base.html" %}
{% block headers %}
    <link rel="stylesheet" type= "text/css" href="{{ url_for('static', filename='css/toggle-switch.css') }}">
    <script>
    $(document).ready(function() {
        function toggleOptionalDivs(){
            var self = $("#action");
            var sval = $(self).find(":selected").val();
            var opts = ["switch-outlet", "sms-message"];
            for (i = 0; i < opts.length; i++) {
                if (opts[i] == sval) {
                    $("#" + opts[i]).css("display","block");
                } else {
                    $("#" + opts[i]).css("display","none");
                }
            }
            var atarg = $("#action_target").val()
            if (sval == 'switch-outlet' && atarg != "") {
                $("#outlet").val(atarg)
            }
            if (sval == 'sms-message' && atarg != "") {
                $("#recipient").val(atarg)
            }
            return false;
        }
        $("button.delete").click(function(){
            var [mode, pk] = this.id.split('-',2);
            if (window.confirm("Are you sure you want to delete this?")) {          
                $.post("/action/" + pk + "/delete",
                    {'csrfmiddlewaretoken': '{{ csrf_token() }}'},
                    function(){
                        window.location.replace("/action");
                    }
                );
            }
			return false;
        });
        $("#action").each(toggleOptionalDivs); 
        $("#action").change(function() {
            $("#action_target").val("");
            toggleOptionalDivs();
        });
    });
    </script>
{% endblock %}
{% block content %}
    <form action="" method="post" name="action" class="pure-form pure-form-aligned">
        {{ form.hidden_tag() }}
        <fieldset>
        <div class="pure-control-group">
            {{ form.type_id.label }}
            {{ form.type_id }}
            {% if form.type_id.errors %}
                {% for err in form.type_id.errors %}
                <span style="color: red;">[{{ err }}]</span>
                {% endfor %}
            {% endif %}
        </div>
        <div class="pure-control-group">
            {{ form.condition.label }}
            {{ form.condition }}
            {% if form.condition.errors %}
                {% for err in form.condition.errors %}
                <span style="color: red;">[{{ err }}]</span>
                {% endfor %}
            {% endif %}
        </div>
        <div class="pure-control-group">
            {{ form.value.label }}
            {{ form.value }}
            {% if form.value.errors %}
                {% for err in form.value.errors %}
                <span style="color: red;">[{{ err }}]</span>
                {% endfor %}
            {% endif %}
        </div>
        <div class="pure-control-group">
            {{ form.action.label }}
            {{ form.action }}
            {% if form.action.errors %}
                {% for err in form.action.errors %}
                <span style="color: red;">[{{ err }}]</span>
                {% endfor %}
            {% endif %}
        </div>
        <div class="pure-control-group" id="switch-outlet">
            {{ form.outlet.label }}
            {{ form.outlet }}
            {% if form.outlet.errors %}
                {% for err in form.outlet.errors %}
                <span style="color: red;">[{{ err }}]</span>
                {% endfor %}
            {% endif %}
            {{ form.action_state.label }}
            {{ form.action_state }}
        </div>
        <div class="pure-control-group" id="sms-message">
            {{ form.recipient.label }}
            {{ form.recipient }}
            {% if form.recipient.errors %}
                {% for err in form.recipient.errors %}
                <span style="color: red;">[{{ err }}]</span>
                {% endfor %}
            {% endif %}
        </div>
        <div class="pure-control-group">
            {{ form.wait_time.label }}
            {{ form.wait_time }}
            {% if form.wait_time.errors %}
                {% for err in form.wait_time.errors %}
                <span style="color: red;">[{{ err }}]</span>
                {% endfor %}
            {% endif %}
        </div>
        <div class="pure-control-group">
            {{ form.active.label }}
            {{ form.active }}
            {% if form.active.errors %}
                {% for err in form.active.errors %}
                <span style="color: red;">[{{ err }}]</span>
                {% endfor %}
            {% endif %}
        </div>
        <div class="pure-controls">
            <button type="submit" class="pure-button pure-button-primary">Submit</button>
            {% if pk %}<button type="button" class="pure-button delete" id="delete-{{ pk }}">Delete</button>{% endif %}
        </div>
        </fieldset>
    </form>
{% endblock %}
