{% extends "base.html" %}
{% block headers %}
  <script>
    function setSwitchValid(self, data) {
        if (data.state == 'on') {
            $(self).checked = true;
        } else {
            $(self).checked = false;
        }
    }
    $(document).ready(function() {
        setInterval(function(){
            $(".onoffswitch-checkbox").each(function(){
                var pk = this.id.split('-',2)[1];
                var self = this;
                $.get("/outlet/" + pk,
                {'csrfmiddlewaretoken': '{{ csrf_token() }}'},
                function(data){
                    setSwitchValid(self, data);
		        }, 'json');
            });
        }, 10000);
        $(".onoffswitch").on('click', function(){
            var pk = this.id.split("-")[1];
            var obj = $("#outletswitch-" + pk);
            if ($(obj).checked = true) {
                setSwitchValid(obj, {"state": "off"});
            } else {
                setSwitchValid(obj, {"state": "on"});
            }
            $.post("/outlet/" + pk + "/toggle",
            {'csrfmiddlewaretoken': '{{ csrf_token() }}'},
            function(data){
                setSwitchValid(obj, data);
			}, 'json');
			return false;
        });
    });
    </script>  
{% endblock %}
{% block content %}
{% if outlets %}
    {% for o in outlets %}
    <a href="/outlet/{{ o.id }}/edit" class="item-link">
    <div class="item">
        <p>
        <div style="display: inline-block; padding-left: 10px;">
        {{ o.name }}
        </div>
        <div class="onoffswitch" id="onoffswitch-{{ o.id }}" style="float: right; padding-right: 10px;">
            <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="outletswitch-{{ o.id }}" style="display: none">
            <label class="onoffswitch-label" for="outletswitch-{{ o.id }}">
                <span class="onoffswitch-inner"></span>
            </label>
        </div>
        </p>
    </div>
    </a>
    {% endfor %}
{% else %}
    <div class="item">
    No outlets defined
    </div>
{% endif %}
<div class="item">
    <p>
    <a href="/outlet/create">
    <span class="fa-stack fa-spin-hover">
    <i class="fa fa-circle-thin fa-stack-2x"></i>
    <i class="fa fa-plus fa-stack-1x"></i>
    </span>
    </a>
    </p>
</div>
{% endblock %}
