{% extends "base.html" %}
{% block headers %}
    <script>
    function setSwitchValid(self, data) {
        if (data.state == true) {
            if (! $(self).hasClass("button-primary")) {
                $(self).addClass("button-primary");
                $(self).text("on");
            }
        } else {
            if ($(self).hasClass("button-primary")) {
                $(self).removeClass("button-primary");
                $(self).text("off");
            }
        }
    }
    $(document).ready(function() {
        setInterval(function(){
            $(".button.toggle").each(function(){
                var pk = this.id.split('-',2)[1];
                var self = this;
                $.get("/outlet/" + pk,
                {'csrfmiddlewaretoken': '{{ csrf_token() }}'},
                function(data){
                    setSwitchValid(self, data);
		        }, 'json');
            });
        }, 10000);

        $(".toggle").on('click', function(){
            var pk = this.id.split("-")[1];
            var self = this;
            if ($(self).hasClass('button-primary')) {
                setSwitchValid(self, {"state": false});
            } else {
                setSwitchValid(self, {"state": true});
            }
            $.post("/outlet/" + pk + "/toggle",
            {'csrfmiddlewaretoken': '{{ csrf_token() }}'},
            function(data){
                setSwitchValid(self, data);
			}, 'json');
			return false;
        });
    });
    </script>
{% endblock %}
{% block content %}
{% if payload %}
    {% for o in payload %}
    <div class="item">
    <p>
    <div style="margin: 0px 10px 0px 10px; display: inline-block;">
    <a href="/outlet/{{ o.id }}/edit">
    <i class="fa fa-edit"></i>
    </a>
    </div>
    {{ o.name }}
    <div class="onoffswitch" style="float: right; padding-right: 10px;">
        <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch-{{ o.id }}" style="display: none">
        <label class="onoffswitch-label" for="myonoffswitch">
            <span class="onoffswitch-inner"></span>
        </label>
    </div>
    </p>
</div>

    <div class="row">    
      <div class="seven columns btn-group">
        <a class="button" " style="width: 80%;">{{ o.name }}</a><a class="button{% if o.state %} button-primary{% endif %} toggle" id="toggle-{{ o.id }}" style="width: 10%;">{% if o.state %}on{% else %}off{% endif %}</a>
      </div>
    </div>
    {% endfor %}
{% else %}
    No outlet data available
{% endif %}
<p>
    <a href="/outlet/create"><i class="fa fa-plus"></i> add</a>
</p>
{% endblock %}
